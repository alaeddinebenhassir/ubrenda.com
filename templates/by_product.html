{% extends "base_generic_1.html"%}
{% block content %}
{% load static %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
<script src="https://js.stripe.com/v3/"></script>
<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
<style>
/**
 * The CSS shown here will not be introduced in the Quickstart guide, but shows
 * how you can use CSS to style your Element's container.
 */
 * {
  font-family: "Helvetica Neue", Helvetica;
  font-size: 15px;
  font-variant: normal;
  padding: 0;
  margin: 0;
}

html {
  height: 100%;
}

body {
  background: #E6EBF1;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100%;
}

form {
  width: 480px;
  margin: 20px 0;
}

.group {
  background: white;
  box-shadow: 0 7px 14px 0 rgba(49, 49, 93, 0.10), 0 3px 6px 0 rgba(0, 0, 0, 0.08);
  border-radius: 4px;
  margin-bottom: 20px;
}

label {
  
  position: relative;
  color: #8898AA;
  font-weight: 300;
  height: 40px;
  line-height: 40px;
  margin-left: 20px;
  display: flex;
  flex-direction: row;
}

.group label:not(:last-child) {
  border-bottom: 1px solid #F0F5FA;
}

label > span {
  width: 120px;
  text-align: right;
  margin-right: 30px;
}

label > span.brand {
  width: 30px;
}

.field {
  background: transparent;
  font-weight: 300;
  border: 0;
  color: #31325F;
  outline: none;
  flex: 1;
  padding-right: 10px;
  padding-left: 10px;
  cursor: text;
}

.field::-webkit-input-placeholder {
  color: #CFD7E0;
}

.field::-moz-placeholder {
  color: #CFD7E0;
}

button {
  float: left;
  display: block;
  background: #666EE8;
  color: white;
  box-shadow: 0 7px 14px 0 rgba(49, 49, 93, 0.10), 0 3px 6px 0 rgba(0, 0, 0, 0.08);
  border-radius: 4px;
  border: 0;
  margin-top: 20px;
  font-size: 15px;
  font-weight: 400;
  width: 100%;
  height: 40px;
  line-height: 38px;
  outline: none;
}

button:focus {
  background: #555ABF;
}

button:active {
  background: #43458B;
}

.outcome {
  float: left;
  width: 100%;
  padding-top: 8px;
  min-height: 24px;
  text-align: center;
}

.success,
.error {
  display: none;
  font-size: 13px;
}

.success.visible,
.error.visible {
  display: inline;
}

.error {
  color: #E4584C;
}

.success {
  color: #666EE8;
}

.success .token {
  font-weight: 500;
  font-size: 13px;
}

 .StripeElement {
  box-sizing: border-box;

  height: 40px;

  padding: 10px 12px;

  border: 1px solid transparent;
  border-radius: 4px;
  background-color: white;

  box-shadow: 0 1px 3px 0 #e6ebf1;
  -webkit-transition: box-shadow 150ms ease;
  transition: box-shadow 150ms ease;
}

.StripeElement--focus {
  box-shadow: 0 1px 3px 0 #cfd7df;
}

.StripeElement--invalid {
  border-color: #fa755a;
}

.StripeElement--webkit-autofill {
  background-color: #fefde5 !important;
}
</style>
<!-- Top header -->
<!-- Cards container -->
    <div class="container text-center">
        <div class="row">
<!-- Card #2, Intermediate -->   
                    <div style="padding: 5px;"class="pricing-description">
                      <h4>Cridit card information </h4>
                                <form action="" method="POST">
                                  {% csrf_token %}
                                  <input type="hidden" name="token" />
                                  <div class="group">
                                    <label>
                                      <span>Card number</span>
                                      <div id="card-number-element" class="field"></div>
                                      <span class="brand"><i class="fa fa-credit-card" id="brand-icon"></i></span>
                                    </label>
                                    <label>
                                      <span>Expiry date</span>
                                      <div id="card-expiry-element" class="field"></div>
                                    </label>
                                    <label>
                                      <span>CVC</span>
                                      <div id="card-cvc-element" class="field"></div>
                                    </label>
                                    <label>
                                      <span>Postal code</span>
                                      <input id="postal-code" name="postal_code" class="field" placeholder="90210" />
                                    </label>
                                  </div>
                                  <button type="submit">Pay ${{ data }}</button>
                                  <div class="outcome">
                                    <div class="error"></div>
                                    <div class="success">
                                      Success! Your Stripe token is <span class="token"></span>
                                    </div>
                                  </div>
                                </form>
                        
                            
        </div>
    </div>
    </div>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js"
        integrity="sha384-pjaaA8dDz/5BgdFUPX6M/9SUZv4d12SUPF0axWc+VRZkx5xU3daN+lYb49+Ax+Tl"
        crossorigin="anonymous"></script>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
<script>
// Create a Stripe client.
var stripe = Stripe('pk_test_eJzUry98i0m3vipsD9oQr2sB0013oq5o3f');

// Create an instance of Elements.
var elements = stripe.elements();
var style = {
  base: {
    iconColor: '#666EE8',
    color: '#31325F',
    lineHeight: '40px',
    fontWeight: 300,
    fontFamily: 'Helvetica Neue',
    fontSize: '15px',

    '::placeholder': {
      color: '#CFD7E0',
    },
  },
};

var cardNumberElement = elements.create('cardNumber', {
  style: style
});
cardNumberElement.mount('#card-number-element');

var cardExpiryElement = elements.create('cardExpiry', {
  style: style
});
cardExpiryElement.mount('#card-expiry-element');

var cardCvcElement = elements.create('cardCvc', {
  style: style
});
cardCvcElement.mount('#card-cvc-element');

// Handle real-time validation errors from the card Element.

function setOutcome(result) {
  var successElement = document.querySelector('.success');
  var errorElement = document.querySelector('.error');
  successElement.classList.remove('visible');
  errorElement.classList.remove('visible');

  if (result.token) {
    // In this example, we're simply displaying the token
    successElement.querySelector('.token').textContent = result.token.id;
    successElement.classList.add('visible');

    var data = {
        'Token' : result.token.id ,
        csrfmiddlewaretoken: $("input[name='csrfmiddlewaretoken']").val(),

    }
    $.ajax({
        data : data ,
        url : 'checkout/',
        method : "POST",
        success :  function(data){
          console.log(data);
          alert('Thanks your payment is successed you will recieve an email with your reciepet');
          window.location.href = "{% url 'index' %} ";

        },
        error : function(error){
            console.log(error);
           
        }
    })
  } else if (result.error) {
    errorElement.textContent = result.error.message;
    errorElement.classList.add('visible');
  }
}

var cardBrandToPfClass = {
	'visa': 'fa-cc-visa',
  'mastercard': 'fa-cc-mastercard',
  'amex': 'fa-cc-american-express',
  'discover': 'fa-cc-discover',
  'diners': 'fa-cc-diners',
  'jcb': 'fa-cc-jcb',
  'unknown': 'fa-cc-credit-card',
}

function setBrandIcon(brand) {
	var brandIconElement = document.getElementById('brand-icon');
  var pfClass = 'fa-credit-card';
  if (brand in cardBrandToPfClass) {
  	pfClass = cardBrandToPfClass[brand];
  }
  for (var i = brandIconElement.classList.length - 1; i >= 0; i--) {
  	brandIconElement.classList.remove(brandIconElement.classList[i]);
  }
  brandIconElement.classList.add('fab');
  brandIconElement.classList.add(pfClass);
}

cardNumberElement.on('change', function(event) {
	// Switch brand logo
	if (event.brand) {
  	setBrandIcon(event.brand);
  }

	setOutcome(event);
});

document.querySelector('form').addEventListener('submit', function(e) {
  e.preventDefault();
  var options = {
    address_zip: document.getElementById('postal-code').value,
  };
  stripe.createToken(cardNumberElement, options).then(setOutcome);
});
// Submit the form with the token ID.


</script>  
{% endblock %}
